---
title: "Projeto ME812"
output: html_notebook
---

Estudo qualitativo-quantitativo de florestas sagradas em Moçambique

Lembrete: Se certificar que está na pasta correta, que contém os dados com getwd() e na hora de salvar usar UTF-8

Bibliotecas
Inserir aqui as bibliotecas necessárias (se não tiver no pc, instalar antes)
```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
library(readxl)
library(dplyr)
library(ggplot2)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
Sys.setlocale("LC_ALL", "en_US.UTF-8")
```


Dados

```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
q1 <- read_excel("Q1_ Perfil dos Entrevistados.xlsx", sheet = 1)
q2 <- read_excel("Q2_ Nome vulgar da Mata e Sacralidade.xlsx", sheet = 1) # engloba totalmente q1
q3 <- read_excel("Q3_ Propriedade e Responsabilidade pela Gestão da Mata.xlsx", sheet = 1)
q4 <- read_excel("Q4_ Estado de conservação e Critérios.xlsx", sheet = 1)
q4_1 <- read_excel("Q4_1 Estado de Conservação_ Risco de desaparacimento.xlsx", sheet = 1)
q5 <- read_excel("Q5_ Serviços Ecossistêmicos.xlsx", sheet = 1)
q5_1 <- read_excel("Q5_1 Serviços Ecossistêmicos _Tendência da Qualidade.xlsx", sheet = 1)
q5_2 <- read_excel("Q5_2 Serviços Ecossistêmicos Potenciais (Animais).xlsx", sheet = 1)
q5_3 <- read_excel("Q5_3 Serviços Ecossistêmicos Potenciais (Plantas).xlsx", sheet = 1)
q6 <- read_excel("Q6_  Conhecimento Sobre as Instituições.xlsx", sheet = 1)
q6_1 <- read_excel("Q6_ 1 Eficiência das Instituições.xlsx", sheet = 1)
q6_2 <- read_excel("Q6_ 2 Sanções.xlsx", sheet = 1)
```

Junção de todos os dados em uma única tabela

```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
tb <- q1 %>% 
  left_join(q2, by = "Id", suffix = c("", ".REPETIDO10")) %>% 
  left_join(q3, by = "Id", suffix = c("", ".REPETIDO1")) %>% 
  left_join(q4, by = "Id", suffix = c("", ".REPETIDO2")) %>%
  left_join(q4_1, by = "Id", suffix = c("", ".REPETIDO3")) %>%
  left_join(q5, by = "Id", suffix = c("", ".REPETIDO4")) %>%
  left_join(q5_1, by = "Id", suffix = c("", ".REPETIDO5")) %>%
  left_join(q5_2, by = "Id", suffix = c("", ".REPETIDO6")) %>%
  left_join(q5_3, by = "Id", suffix = c("", ".REPETIDO7")) %>%
  left_join(q6, by = "Id", suffix = c("", ".REPETIDO8")) %>%
  left_join(q6_1, by = "Id", suffix = c("", ".REPETIDO9")) %>%
  left_join(q6_2, by = "Id", suffix = c("", ".REPETIDO0"))
  

tb <- tb[,!grepl("REPETIDO", names(tb))]

tb <- tb[, -c(23, 24)] # repetidos 

saveRDS(tb, file = "tabela")

rm(q1, q2, q3, q4, q4_1, q5, q5_1, q5_2, q5_3, q6, q6_1, q6_2)
```

Ler dados já pronto
```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
tb <- readRDS("tabela")

head(tb)
```

Mudando str do banco de dados
```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
tb$Sistema <- as.factor(tb$Sistema)
tb$Sexo <- as.factor(tb$Sexo)
tb$`Há (mais ou menos) quanto tempo conhece a mata ?` <- as.numeric(tb$`Há (mais ou menos) quanto tempo conhece a mata ?`) # há valores SR que foram transformados em NA
tb$`Total de critérios mencionados` <- ifelse(tb$`Total de critérios mencionados`=="?",0,tb$`Total de critérios mencionados`)
tb$`Total de critérios mencionados` <- as.numeric(tb$`Total de critérios mencionados`)
tb$`Como avalia o estado de conservação daquele lugar?` <- as.factor(tb$`Como avalia o estado de conservação daquele lugar?`)
tb$Ocupação <- as.factor(tb$Ocupação)
# Critérios
# for(i in 14:20) {
#   tb[,i] <- as.factor(tb[,i])
# }
```

Perfil dos entrevistados

Sexo
```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
ggplot(tb, aes(Sexo, fill = Sexo)) +
  geom_histogram(stat="count") +
  ylab("Frequência") +
  scale_fill_manual(labels = c("Feminino", "Masculino"), 
                    values=c( "#FFA8A8", "#86BCFF", "#72FE95", "#FFFF84", "#FFB347")) +
  # theme(legend.position = "none") +
  geom_text(stat="count", aes(label=paste0(round(..count../nrow(tb)*100,2),"%")), position=position_dodge(width=0.9), vjust=-0.25) +
  ylim(0, 100) +
  ggtitle("Sexo dos entrevistados")
```


Idade
Faixa 1: 18-30;
Faixa 2: 30-50;
Faixa 3: 50 +
```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
tb$FaixaIdade <- NA
tb$FaixaIdade <- ifelse(tb$Idade<30, 1, 2)
tb$FaixaIdade <- ifelse(tb$Idade>50, 3, tb$FaixaIdade)
tb$FaixaIdade <- as.factor(tb$FaixaIdade)

ggplot(tb, aes(Idade, fill = FaixaIdade)) +
  geom_histogram(stat="count") +
  ylab("Frequência") +
  scale_fill_manual(labels = c("18-30", "31-54", "55 ou mais"), 
                    values=c( "#FFA8A8", "#D97BFD", "#86BCFF", "#72FE95", "#FFFF84", "#FFB347")) +
  # theme(legend.position = "none") +
  ggtitle("Idade dos entrevistados")
```

```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
summary(tb$Idade)
```

```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
ggplot(tb, aes(FaixaIdade, fill = FaixaIdade)) +
  geom_histogram(stat="count") +
  ylab("Frequência") +
  scale_fill_manual(labels = c("18-30", "31-54", "55 ou mais"), 
                    values=c( "#FFA8A8", "#D97BFD", "#86BCFF", "#72FE95", "#FFFF84", "#FFB347")) +
  # theme(legend.position = "none") +
  geom_text(stat="count", aes(label=paste0(round(..count../nrow(tb)*100,2),"%")), position=position_dodge(width=0.9), vjust=-0.25) +
  ylim(0, 80) +
  ggtitle("Idade dos entrevistados")
```

Ocupação
```{r, echo=FALSE,warning=FALSE,message=FALSE,error=FALSE}
positions <- c("Agricultura\nfamiliar","Outra","Agricultura","Agricultora","Aposentado","Desempregado","Extrativismo","Medicina\ntradicional","Funcionario do\nSector Privado","Autoridade\ntradicional","Estudante","Funcionario\npúblico","Pesca\nartesanal","Terceiro\nsector","LiderançaComunitária")

levels(tb$Ocupação) <- gsub(" ", "\n", levels(tb$Ocupação))
levels(tb$Ocupação)[9] <- "Funcionario do\nSector Privado"

ggplot(tb, aes(Ocupação, fill = Ocupação)) +
  geom_histogram(stat="count") +
  scale_x_discrete(limits = positions, drop = FALSE) +
  ylab("Frequência") +
  #scale_fill_manual(labels = c("18-30", "31-54", "55 ou mais"), 
                    #values=c( "#FFA8A8", "#D97BFD", "#86BCFF", "#72FE95", "#FFFF84", "#FFB347")) +
  theme(legend.position = "none", axis.text.x = element_text(angle=90, vjust = 0.5, hjust = 1)) +
  geom_text(stat="count", aes(label=paste0(round(..count../nrow(tb)*100,2),"%")), position=position_dodge(width=0.9), vjust=-0.25) +
  ylim(0, 75) +
  ggtitle("Ocupação dos entrevistados")
```

Estado de conservação
```{r}

conservacao <- tb[1,c(15:21)]
conservacao$`Engajamento da comunidade e frequência de visitações` <- sum(as.numeric(tb$`Engajamento da comunidade e frequência de visitações`), na.rm = TRUE)
conservacao$`Respeito às instituições` <- sum(as.numeric(tb$`Respeito às instituições`), na.rm = TRUE)
conservacao$Limpeza <- sum(as.numeric(tb$Limpeza), na.rm = TRUE)
conservacao$`Existência de símbolos o sagrado` <- sum(as.numeric(tb$`Existência de símbolos o sagrado`), na.rm = TRUE)
conservacao$`Tamanho do fragmento` <- sum(as.numeric(tb$`Tamanho do fragmento`), na.rm = TRUE)
conservacao$Outro <- sum(as.numeric(tb$Outro), na.rm = TRUE)
conservacao$`Árvores, animais e água` <- sum(as.numeric(tb$`Árvores, animais e água`), na.rm = TRUE)

conservacao <- as.data.frame(t(conservacao))
conservacao$Critério <- rownames(conservacao)
conservacao$Critério <- as.factor(conservacao$Critério)

positions <- c("Limpeza","Respeito\nàs\ninstituições","Outro","Árvores,\nanimais\ne\nágua","Engajamento\nda\ncomunidade\ne\nfrequência\nde\nvisitações","Tamanho\ndo\nfragmento","Existência\nde\nsímbolos\no\nsagrado","Total\nde\ncritérios\nmencionados")

levels(conservacao$Critério) <- gsub(" ", "\n", levels(conservacao$Critério))

ggplot(conservacao, aes(x = Critério, y = V1, fill = Critério)) + 
  geom_bar(stat = "identity") +
  scale_x_discrete(limits = positions, drop = FALSE) +
  ylab("Frequência") +
  theme(legend.position = "none", axis.text.x = element_text(angle=0)) +
  #geom_text(stat="identity", aes(label=paste0(round(..count../nrow(tb)*100,2),"%")), position=position_dodge(width=0.9), vjust=-0.25) +
  #ylim(0, 75) +
  ggtitle("Critérios de estado de conservação")

```


